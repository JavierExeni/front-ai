<div class="p-4">
  @if (isLoadingCompany()) {
    <div class="text-center py-8">
      <p class="text-base-content/70">Loading company information...</p>
    </div>
  } @else if (currentUser()) {
    <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Company Name -->
      <div>
        <label for="company_name" class="block text-sm font-medium text-base-content mb-2">
          Company Name
        </label>
        <input
          pSize="small"
          pInputText
          id="company_name"
          formControlName="name"
          class="w-full"
          [class.border-error]="companyForm.get('name')?.invalid && companyForm.get('name')?.touched"
        />
        @if (companyForm.get('name')?.invalid && companyForm.get('name')?.touched) {
          <small class="text-error">Company name is required</small>
        }
      </div>

      <!-- Website -->
      <div>
        <label for="website" class="block text-sm font-medium text-base-content mb-2">
          Website
        </label>
        <input
          pSize="small"
          pInputText
          id="website"
          formControlName="website"
          class="w-full"
          placeholder="https://example.com"
        />
      </div>

      <!-- Headquarters -->
      <div>
        <label for="headquarters" class="block text-sm font-medium text-base-content mb-2">
          Headquarters
        </label>
        <input
          pSize="small"
          pInputText
          id="headquarters"
          formControlName="headquarters"
          class="w-full"
          placeholder="City, Country"
        />
      </div>

      <!-- Company Size -->
      <div>
        <label for="size" class="block text-sm font-medium text-base-content mb-2">
          Company Size
        </label>
        <p-select
          id="size"
          [options]="companySizes"
          formControlName="size"
          optionLabel="label"
          optionValue="value"
          placeholder="Select company size..."
          size="small"
          class="w-full"
        />
      </div>

      <!-- Submit Button -->
      <div class="flex justify-end">
        <button
          size="small"
          pButton
          type="submit"
          label="Save Changes"
          [loading]="isLoading()"
          [disabled]="companyForm.invalid || isLoading()"
          class="btn btn-primary"
        ></button>
      </div>
    </form>

    <!-- Delete Company Section -->
    <div class="mt-8 pt-6 border-t border-base-300">
      <h2 class="text-xl font-semibold text-base-content mb-2">Delete Company</h2>

      @if (!canDeleteCompany()) {
        <p class="text-base-content/70 mb-4">
          You cannot delete the company because it is the only company in your account. You need to create another company before you can delete this one.
        </p>
        <button
          pButton
          size="small"
          type="button"
          label="Delete Company"
          [disabled]="true"
          severity="danger"
          class="btn btn-error"
        ></button>
      } @else {
        <p class="text-base-content/70 mb-4">
          Delete this company and all associated data. This action is irreversible.
        </p>

        @if (!showDeleteConfirm()) {
          <button
            pButton
            size="small"
            type="button"
            label="Delete Company"
            (click)="toggleDeleteConfirm()"
            severity="danger"
            class="btn btn-error"
          ></button>
        } @else {
          <div class="bg-error/10 border border-error rounded-lg p-4">
            <p class="text-error font-medium mb-4">
              Are you sure you want to delete this company? This action cannot be undone.
            </p>
            <div class="flex gap-2">
              <button
                pButton
                type="button"
                label="Confirm Delete"
                (click)="deleteCompany()"
                [loading]="isDeleting()"
                [disabled]="isDeleting()"
                severity="danger"
                class="btn btn-error"
              ></button>
              <button
                pButton
                type="button"
                label="Cancel"
                (click)="toggleDeleteConfirm()"
                [disabled]="isDeleting()"
                severity="secondary"
                outlined="true"
                class="btn btn-ghost"
              ></button>
            </div>
          </div>
        }
      }
    </div>
  } @else {
    <div class="text-center py-8">
      <p class="text-base-content/70">No company associated with your account.</p>
    </div>
  }
</div>
